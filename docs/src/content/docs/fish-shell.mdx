---
title: Fish Shell
description: Configuraci√≥n completa de Fish shell con plugins, keybindings y herramientas integradas
---

# üêü Fish Shell

**Fish** (Friendly Interactive Shell) es un shell moderno con autocompletado inteligente, sintaxis coloreada y configuraci√≥n sencilla. Esta configuraci√≥n est√° basada en [kaku](https://github.com/linuxmobile/kaku) y proporciona una experiencia de shell productiva y personalizada.

La configuraci√≥n se encuentra en:
```
modules/hm/programs/terminal/shell/
```

## Configuraci√≥n Principal

### Archivo de configuraci√≥n

La configuraci√≥n principal de Fish se encuentra en:
```
modules/hm/programs/terminal/shell/fish.nix
```

### Habilitar Fish Shell

En `hydenix-config.nix`:

```nix
modules.terminal.shell.fish = {
  enable = true;
  editor = "nvim";           # Editor por defecto (EDITOR y VISUAL)
  nixosHost = "hydenix";     # Host para comandos nixos-rebuild
};
```

## Caracter√≠sticas Principales

### Variables de Entorno y Secrets

Fish carga autom√°ticamente secrets desde agenix (si existen):

- **DISCORDO_TOKEN** / **OXICORD_TOKEN**: Desde `/run/agenix/discordo`
- **OPENROUTER_API_KEY**: Desde `/run/agenix/openrouter`
- **GITHUB_TOKEN**: Desde `/run/agenix/github`
- **TWT_TOKEN**: Desde `/run/agenix/twt`

Estos se cargan autom√°ticamente si los archivos existen en `/run/agenix/`.

### Keybindings Personalizados

#### Keybindings Vi

Fish usa keybindings estilo Vi por defecto:

- **Modo normal**: Navegaci√≥n y comandos
- **Modo insert**: Edici√≥n de texto
- **Modo visual**: Selecci√≥n de texto

#### Keybindings Personalizados

Keybindings disponibles en ambos modos (insert y default):

- **`Ctrl+Backspace`**: Eliminar palabra anterior
- **`Ctrl+Z`**: Deshacer
- **`Ctrl+B`**: Ir al inicio de l√≠nea
- **`Ctrl+E`**: Ir al final de l√≠nea
- **`Ctrl+X Ctrl+E`**: Editar comando en editor (`edit_command_buffer`)

#### Navegaci√≥n de Historial

- **`‚Üë` / `‚Üì`**: B√∫squeda de historial con prefijo (como nushell)
  - Busca comandos que empiezan con lo que has escrito
  - M√°s eficiente que navegaci√≥n normal

#### Keybindings Deshabilitados (para Zellij)

Los siguientes keybindings est√°n deshabilitados para evitar conflictos con Zellij:

- **`Alt+S`**: Deshabilitado
- **`Alt+V`**: Deshabilitado
- **`Alt+Z`**: Deshabilitado

### Cursor Shapes por Modo

El cursor cambia de forma seg√∫n el modo Vi:

- **Default**: `block` (bloque s√≥lido)
- **Insert**: `line` (l√≠nea vertical)
- **Replace**: `underscore` (guion bajo)
- **Visual**: `block` (bloque s√≥lido)

### Colores de Sintaxis

- **Autosugerencias**: `brblack` (gris oscuro)
- **Comandos**: `blue`
- **Errores**: `red`
- **Par√°metros**: `normal` (color por defecto)

## Plugins Instalados

Fish incluye los siguientes plugins:

1. **autopair**: Cierra par√©ntesis, comillas y brackets autom√°ticamente
2. **done**: Notificaci√≥n cuando termina un comando largo (m√≠nimo 10 segundos)
3. **bass**: Ejecutar scripts bash en Fish
4. **plugin-git**: Aliases extendidos de Git
5. **plugin-sudope**: `Ctrl+S` para agregar `sudo` al comando actual
6. **humantime-fish**: Formato legible de tiempo (ej: "2 hours ago")
7. **fifc**: Fuzzy finder para completions (`Ctrl+V` para abrir)
8. **grc**: Coloriza output de comandos
9. **puffer**: Expande `...` a `../../..` autom√°ticamente

### Configuraci√≥n de Plugins

```nix
# Plugin settings en interactiveShellInit
set -Ux fifc_editor nvim        # Editor para fifc
set -U fifc_keybinding \cv      # Keybinding para fifc (Ctrl+V)
set -g __done_min_cmd_duration 10000  # Duraci√≥n m√≠nima para notificaci√≥n (10s)
set -g sudope_sequence \cs      # Keybinding para sudope (Ctrl+S)
```

## Funciones Personalizadas

### `fcd` - Navegar a directorio con fuzzy finder

Navega a un directorio usando `fd` y `sk` (skim):

```fish
fcd
```

Busca todos los directorios y te permite seleccionar uno para cambiar.

### `installed` - Ver paquetes instalados

Lista los paquetes instalados en el sistema (solo nombres):

```fish
installed
```

Muestra una lista de paquetes instalados usando `sk` para b√∫squeda.

### `installedall` - Ver todos los paquetes con path completo

Lista todos los paquetes con su path completo y copia al portapapeles:

```fish
installedall
```

√ötil para ver la ruta completa de un paquete en el nix store.

### `fm` - File manager con Yazi

Abre Yazi y cambia al directorio seleccionado al salir:

```fish
fm [directorio]
```

Si no especificas directorio, abre en el directorio actual.

### `gitgrep` - Buscar en archivos tracked por Git

Busca en archivos que est√°n siendo tracked por Git:

```fish
gitgrep "patr√≥n"
```

Equivalente a `git ls-files | rg patr√≥n`.

## Abbreviations

Las abbreviations se expanden autom√°ticamente al presionar espacio:

- **`z`**: Se expande a `zoxide query`
- **`zi`**: Se expande a `zoxide query -i` (interactivo)

## Aliases

### NixOS - Mantenimiento

- **`cleanup`**: `sudo nix-collect-garbage --delete-older-than 1d`
- **`listgen`**: `sudo nix-env -p /nix/var/nix/profiles/system --list-generations`
- **`nixremove`**: `nix-store --gc`
- **`bloat`**: `nix path-info -Sh /run/current-system`
- **`cleanram`**: `sudo sh -c 'sync; echo 3 > /proc/sys/vm/drop_caches'`
- **`trimall`**: `sudo fstrim -va`

### Navegaci√≥n

- **`c`**: `clear`
- **`q`**: `exit`
- **`temp`**: `cd /tmp/`

### NixOS Rebuild

- **`test-build`**: `sudo nixos-rebuild test --flake .#hydenix`
- **`switch-build`**: `sudo nixos-rebuild switch --flake .#hydenix`

El host (`hydenix`) se configura en `hydenix-config.nix`.

### Git

- **`add`**: `git add .`
- **`commit`**: `git commit`
- **`push`**: `git push`
- **`pull`**: `git pull`
- **`diff`**: `git diff --staged`
- **`gcld`**: `git clone --depth 1`
- **`gitui`**: `lazygit`

### Herramientas Mejoradas

- **`l`**: `eza -lF --time-style=long-iso --icons`
- **`ll`**: `eza -h --git --icons --color=auto --group-directories-first -s extension`
- **`tree`**: `eza --tree --icons --tree`
- **`cat`**: `bat --paging=never`
- **`moon`**: `curl -s wttr.in/Moon`
- **`weather`**: `curl -s wttr.in`
- **`store-path`**: `readlink (which $argv)`

### Systemd

- **`us`**: `systemctl --user`
- **`rs`**: `sudo systemctl`

### Apps

- **`zed`**: `zeditor` (Zed Editor)

## Integraciones

### Carapace - Autocompletado Multi-Shell

Carapace proporciona autocompletado inteligente para m√∫ltiples shells. Configuraci√≥n separada en:

```
modules/hm/programs/terminal/shell/carapace.nix
```

**Habilitar:**

```nix
modules.terminal.shell.carapace = {
  enable = true;
};
```

Carapace incluye:
- **carapace**: Motor de autocompletado
- **carapace-bridge**: Puente para m√∫ltiples shells
- **inshellisense**: Autocompletado adicional

Variables de entorno:
- `CARAPACE_BRIDGES = "fish,zsh,bash,inshellisense"`
- `CARAPACE_CACHE_DIR = "~/.cache/carapace"`

### Starship - Prompt Personalizado

Starship proporciona un prompt r√°pido y personalizable. Configuraci√≥n en:

```
modules/hm/programs/terminal/shell/starship.nix
```

**Habilitar:**

```nix
modules.terminal.shell.starship = {
  enable = true;
  enableFishIntegration = true;
};
```

El prompt de Fish usa un formato de 2 l√≠neas:
- **L√≠nea 1**: `$status$username$hostname$directory$git_branch$git_status$cmd_duration$nix_shell`
- **L√≠nea 2**: `$character`

**M√≥dulos habilitados:**
- `status`: Estado del √∫ltimo comando (‚îÇ en blanco/rojo)
- `username`: Usuario actual (solo si no es el usuario por defecto)
- `hostname`: Hostname (solo en SSH)
- `directory`: Directorio actual (truncado a 1 nivel)
- `git_branch`: Rama de Git actual
- `git_status`: Estado de Git (modificados, staged, etc.)
- `cmd_duration`: Duraci√≥n de comandos largos (m√≠nimo 2 segundos)
- `nix_shell`: Indicador de shell de desarrollo Nix

**M√≥dulos deshabilitados** (para mejor rendimiento):
- Todos los m√≥dulos de lenguajes (nodejs, python, rust, etc.)
- AWS, GCloud, Kubernetes, etc.
- Battery, time, package, conda, docker_context

### fzf - Fuzzy Finder

Integraci√≥n con fzf para b√∫squeda fuzzy:

```
modules/hm/programs/terminal/software/fzf.nix
```

**Habilitar:**

```nix
modules.terminal.software.fzf = {
  enable = true;
  enableFishIntegration = true;
};
```

**Configuraci√≥n:**
- Keybindings de fzf cargados autom√°ticamente
- `FZF_DEFAULT_OPTS = "--reverse --height 40% --border"`

### Zoxide - Navegaci√≥n Inteligente

Zoxide aprende tus directorios frecuentes:

```
modules/hm/programs/terminal/software/zoxide.nix
```

**Habilitar:**

```nix
modules.terminal.software.zoxide = {
  enable = true;
  enableFishIntegration = true;
};
```

**Uso:**
- `z carpeta`: Salta a un directorio visitado frecuentemente
- `zi`: Modo interactivo para seleccionar directorio
- Abbreviations: `z` y `zi` se expanden autom√°ticamente

### Atuin - Historial Mejorado

Atuin reemplaza el historial de Fish con una base de datos SQLite:

```
modules/hm/programs/terminal/software/atuin.nix
```

**Habilitar:**

```nix
modules.terminal.software.atuin = {
  enable = true;
  enableFishIntegration = true;
  enableZshIntegration = false;  # No afectar zsh/Hydenix
};
```

**Caracter√≠sticas:**
- B√∫squeda fuzzy con skim
- Filtrado por host y sesi√≥n
- Modo vim para navegaci√≥n
- Sincronizaci√≥n opcional (deshabilitada por defecto)
- Formato compacto

**Configuraci√≥n:**
- `search_mode = "skim"`: Usa skim para b√∫squeda
- `filter_mode = "host"`: Filtra por host actual
- `keymap_mode = "vim-normal"`: Navegaci√≥n estilo vim
- `style = "compact"`: Interfaz compacta
- `history_filter = ["shit"]`: Comandos a ignorar

### Autojump - Navegaci√≥n R√°pida

Autojump aprende tus directorios frecuentes (alternativa a zoxide):

```
modules/hm/programs/terminal/software/autojump.nix
```

**Habilitar:**

```nix
modules.terminal.software.autojump = {
  enable = true;
};
```

**Uso:**
- `j carpeta`: Salta a un directorio frecuente
- Aprende autom√°ticamente de tus `cd`

## Agregar Nuevas Funciones

Para agregar una nueva funci√≥n personalizada, edita `fish.nix`:

```nix
functions = {
  mi-funcion = ''
    # C√≥digo de la funci√≥n aqu√≠
    echo "Hola desde mi funci√≥n"
  '';
};
```

## Agregar Nuevos Aliases

Para agregar un nuevo alias:

```nix
shellAliases = {
  mi-alias = "comando --opciones";
};
```

## Agregar Nuevas Abbreviations

Para agregar una nueva abbreviation:

```nix
shellAbbrs = {
  gs = "git status";
};
```

## Aplicar Cambios

Despu√©s de modificar `fish.nix`:

```bash
make switch
# o
home-manager switch
```

Luego reinicia tu terminal o ejecuta:

```fish
source ~/.config/fish/config.fish
```

## Recursos

- **Documentaci√≥n oficial de Fish**: https://fishshell.com/docs/current/
- **Plugins de Fish**: https://github.com/oh-my-fish/oh-my-fish/blob/master/docs/Plugins.md
- **kaku (inspiraci√≥n)**: https://github.com/linuxmobile/kaku

