---
title: Pruebas y ValidaciÃ³n
description: GuÃ­a de pruebas para validar el Makefile modular
---

# Pruebas y ValidaciÃ³n

Esta guÃ­a documenta los comandos de prueba para validar el funcionamiento correcto del Makefile modular sin realizar cambios destructivos en el sistema.

## ğŸ¯ FilosofÃ­a de Pruebas

El Makefile modular mantiene **exactamente el mismo comportamiento** que el Makefile original, preservando:

- âœ… Orden de categorÃ­as y comandos
- âœ… Formato visual (separadores, colores, emojis)
- âœ… ValidaciÃ³n de parÃ¡metros obligatorios
- âœ… Mensajes de ayuda y ejemplos

## ğŸ§ª Comandos de ValidaciÃ³n

### Pruebas BÃ¡sicas (No Destructivas)

Estos comandos son **seguros** y no modifican el sistema:

#### 1. Verificar Sistema de Ayuda

```bash
make help
```

**ValidaciÃ³n esperada:**
- Muestra todas las categorÃ­as en el orden correcto
- Incluye todos los comandos con descripciones
- Formato visual consistente con separadores `â•â•â•â•â•â•â•â•`
- Workflows sugeridos al final

**Salida esperada:**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       Ayuda Avanzada y Workflows (Makefile)        
 
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 
Ayuda y DocumentaciÃ³n 
  help                 Show this help message
  help-examples        Show commands with usage examples
  ...

GestiÃ³n del Sistema (Rebuild/Switch) 
  switch               Build and switch to new configuration
  safe-switch          Validate then switch (safest option)
  ...

Workflows sugeridos:
  â€¢ Flujo Pro:          make format â†’ make validate â†’ make switch
  â€¢ Updates seguros:    make update â†’ make flake-diff â†’ make validate â†’ make switch
  â€¢ RecuperaciÃ³n:       make list-generations â†’ make rollback
```

#### 2. Verificar Ejemplos de Uso

```bash
make help-examples
```

**ValidaciÃ³n esperada:**
- Muestra ejemplos con parÃ¡metros obligatorios
- Formato con bordes decorativos `â•”â•â•â•â•—`
- CategorÃ­as organizadas con emojis
- Comandos comunes sin parÃ¡metros al final

**Salida esperada:**

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 â•‘        NixOS Commands with Usage Examples          â•‘
 â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 
ğŸ’¡ Tip: Commands without parameters can be run directly 
   Commands with parameters are shown with examples below 

â•â•â• ğŸ”¨ Build & Deploy â•â•â• 
switch HOSTNAME=<host> 
  â†’ make switch HOSTNAME=laptop

â•â•â• ğŸ” Search & Discovery â•â•â• 
search PKG=<name> 
  â†’ make search PKG=firefox
  ...
```

#### 3. Listar Hosts Disponibles

```bash
make list-hosts
```

**ValidaciÃ³n esperada:**
- Muestra todos los hosts configurados
- Indica el host actual con `(current)`
- Formato con separadores `â•â•â•â•â•â•â•â•`
- InformaciÃ³n detallada de cada host

**Salida esperada:**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ğŸ“‹ Available Hosts                         
 
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 
Total hosts:  3 
Configured:  3 

Hosts overview: 
  hydenix          âœ“  configured (current) 
  laptop           âœ“  configured
  vm               âœ“  configured
  ...
```

#### 4. BÃºsqueda de Paquetes

```bash
make search PKG=hello
```

**ValidaciÃ³n esperada:**
- Requiere parÃ¡metro `PKG`
- Muestra encabezado con emoji ğŸ”
- Ejecuta bÃºsqueda en nixpkgs
- Muestra resultados relevantes

**Salida esperada:**

```
ğŸ” Searching for: hello
================================
evaluating 'legacyPackages.x86_64-linux'...
...
* legacyPackages.x86_64-linux.hello (2.12.1)
  A program that produces a familiar, friendly greeting
```

#### 5. InformaciÃ³n del Sistema

```bash
make info
```

**ValidaciÃ³n esperada:**
- Muestra informaciÃ³n del sistema actual
- Versiones de NixOS y componentes
- No requiere permisos especiales
- Salida formateada y legible

### Pruebas Opcionales (Requieren ConfirmaciÃ³n)

Estos comandos son seguros pero pueden tardar mÃ¡s tiempo:

#### 6. Dry Run (SimulaciÃ³n)

```bash
make dry-run
```

**ValidaciÃ³n esperada:**
- Muestra quÃ© se construirÃ­a sin aplicar cambios
- Ãštil para verificar sintaxis de configuraciÃ³n
- No modifica el sistema
- Puede tardar varios minutos

#### 7. ValidaciÃ³n de ConfiguraciÃ³n

```bash
make validate
```

**ValidaciÃ³n esperada:**
- Verifica sintaxis de archivos `.nix`
- Ejecuta `nix flake check`
- No aplica cambios
- Reporta errores de configuraciÃ³n si existen

### Pruebas de ParÃ¡metros Obligatorios

Estos comandos **deben fallar** si no se proporciona el parÃ¡metro:

```bash
# Debe fallar con mensaje de error
make search
# Error esperado: âŒ Error: PKG parameter is required

make update-input
# Error esperado: âŒ Error: INPUT parameter is required

make logs-service
# Error esperado: âŒ Error: SVC parameter is required

make diff-gen
# Error esperado: âŒ Error: GEN1 and GEN2 parameters are required
```

## âš ï¸ Comandos Destructivos (NO Ejecutar en Pruebas)

Estos comandos **modifican el sistema** y NO deben ejecutarse durante validaciÃ³n:

### ğŸš« GestiÃ³n del Sistema
- `make switch` - Aplica configuraciÃ³n permanentemente
- `make test` - Aplica configuraciÃ³n temporalmente
- `make boot` - Cambia configuraciÃ³n de arranque

### ğŸš« Limpieza
- `make clean` - Elimina generaciones antiguas
- `make deep-clean` - Limpieza agresiva
- `make fix-store` - Repara el store de Nix

### ğŸš« Actualizaciones
- `make update` - Actualiza inputs del flake
- `make upgrade` - Actualiza y aplica cambios

### ğŸš« Git
- `make git-push` - Sube cambios al repositorio
- `make sync` - SincronizaciÃ³n total (commit y push automÃ¡tico)

## âœ… Checklist de ValidaciÃ³n

Usa este checklist para verificar el Makefile modular:

- [ ] `make help` muestra todas las categorÃ­as en orden correcto
- [ ] `make help-examples` muestra ejemplos con formato correcto
- [ ] `make list-hosts` muestra hosts configurados
- [ ] `make search PKG=hello` ejecuta bÃºsqueda correctamente
- [ ] `make search` (sin PKG) falla con mensaje de error apropiado
- [ ] `make info` muestra informaciÃ³n del sistema
- [ ] `make dry-run` simula construcciÃ³n sin errores (opcional)
- [ ] `make validate` verifica configuraciÃ³n sin errores (opcional)
- [ ] Formato visual consistente (separadores, colores, emojis)
- [ ] No hay targets perdidos o duplicados
- [ ] DocumentaciÃ³n sincronizada con comandos disponibles

## ğŸ¨ ValidaciÃ³n Visual

El Makefile usa un sistema consistente de formato visual:

### Separadores

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Bordes Decorativos

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 â•‘                    TÃ­tulo                          â•‘
 â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Colores (Variables)

- `$(RED)` - Errores y advertencias
- `$(GREEN)` - Ã‰xitos y confirmaciones
- `$(YELLOW)` - Advertencias y notas
- `$(BLUE)` - InformaciÃ³n general
- `$(PURPLE)` - TÃ­tulos y encabezados
- `$(CYAN)` - Comandos y ejemplos
- `$(NC)` - Reset (sin color)

### Emojis Consistentes

- ğŸ“¦ Actualizaciones y paquetes
- ğŸ” BÃºsqueda y anÃ¡lisis
- âœ… Ã‰xito y confirmaciÃ³n
- âŒ Error y fallo
- ğŸ’¡ Tips y sugerencias
- ğŸ“‹ Listas e informaciÃ³n
- ğŸ”¨ ConstrucciÃ³n y deploy
- ğŸ§¹ Limpieza y mantenimiento

## ğŸ”„ Workflow de ValidaciÃ³n Completo

Secuencia recomendada para validar el Makefile modular:

```bash
# 1. Verificar sistema de ayuda
make help
make help-examples

# 2. Verificar comandos informativos
make list-hosts
make info

# 3. Verificar bÃºsqueda
make search PKG=hello

# 4. Verificar validaciÃ³n de parÃ¡metros (deben fallar)
make search          # Debe fallar
make update-input    # Debe fallar

# 5. ValidaciÃ³n opcional (si el usuario lo permite)
make dry-run
make validate
```

## ğŸ“Š Criterios de AceptaciÃ³n

El Makefile modular es vÃ¡lido si cumple:

1. âœ… **Funcionalidad completa** - Todos los targets funcionan igual que antes
2. âœ… **Orden preservado** - CategorÃ­as y comandos en el mismo orden
3. âœ… **Formato visual** - Separadores, colores y emojis consistentes
4. âœ… **ValidaciÃ³n de parÃ¡metros** - Errores apropiados para parÃ¡metros faltantes
5. âœ… **DocumentaciÃ³n sincronizada** - Docs reflejan comandos disponibles
6. âœ… **Sin regresiones** - NingÃºn comando perdido o roto
7. âœ… **Modularidad** - CÃ³digo organizado en `make/*.mk`

## ğŸ› Troubleshooting

### Problema: `make help` no muestra todos los comandos

**SoluciÃ³n:** Verificar que todos los mÃ³dulos estÃ©n incluidos en `Makefile`:

```bash
grep "include make/" Makefile
```

### Problema: Formato visual inconsistente

**SoluciÃ³n:** Verificar variables de color en `Makefile`:

```bash
grep "^RED\|^GREEN\|^YELLOW" Makefile
```

### Problema: Comando no encontrado

**SoluciÃ³n:** Verificar que el target estÃ© en `.PHONY` y en el mÃ³dulo correcto:

```bash
grep "^\.PHONY:" Makefile make/*.mk
```

## ğŸ“š Referencias

- [Estructura Modular](./index#estructura-modular) - OrganizaciÃ³n de mÃ³dulos
- [Ayuda y DocumentaciÃ³n](./01-docs) - Sistema de ayuda
- [GestiÃ³n del Sistema](./02-system) - Comandos de sistema
