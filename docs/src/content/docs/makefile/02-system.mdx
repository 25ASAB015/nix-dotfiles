---
title: GestiÃ³n del Sistema
description: Comandos para compilar, aplicar y validar configuraciones de NixOS
---

# GestiÃ³n del Sistema

MÃ³dulo: `make/system.mk`

Comandos para compilar, probar, aplicar y validar configuraciones de NixOS. Estos son los comandos fundamentales para el mantenimiento del sistema.

## Resumen de Comandos (Prefijo `sys-`)

| Comando | DescripciÃ³n | Acceso RÃ¡pido |
| :--- | :--- | :--- |
| **`make sys-apply`** | Aplicar configuraciÃ³n (Rebuild + Switch) | `make switch` |
| **`make sys-deploy`** | Add + Commit + Push + Apply | `make sync` |
| **`make sys-check`** | Validar sintaxis y flake | `make validate` |
| **`make sys-status`** | Dashboard de salud del sistema | `make health` |

> [!TIP]
> Para ver la lista completa de comandos antiguos y su equivalencia, consulta la [GuÃ­a de Aliases](../10-aliases).

---

## Comandos Principales

### `make sys-apply`
**â­ Comando mÃ¡s usado** - Compila y activa tu nueva configuraciÃ³n.

```bash
make sys-apply
```

**QuÃ© hace:**
1. `make sys-fix-git` - Corrige permisos en el repositorio Git
2. `git add .` - Prepara todos los cambios para commit
3. Compila la configuraciÃ³n del Flake
4. Activa la nueva configuraciÃ³n inmediatamente

---

### `make sys-deploy`
**ðŸš€ SincronizaciÃ³n Total** - Realiza el flujo completo de respaldo y aplicaciÃ³n.

```bash
make sys-deploy
```

**QuÃ© hace:**
1. **`make sys-doctor`** - Verifica y corrige permisos en `~/.config` y `~/.local`
2. **`make sys-fix-git`** - Corrige permisos en el repositorio Git
3. `make git-add` - Prepara todos los cambios
4. `make git-commit` - Crea respaldo con timestamp (salta si no hay cambios)
5. `make git-push` - Sube cambios al repositorio remoto
6. **`make sys-apply-core`** - Aplica la configuraciÃ³n localmente

**PropÃ³sito:** Asegurar que tu configuraciÃ³n estÃ© respaldada en la nube y aplicada localmente en un solo paso.

---

### `make sys-apply-safe`
Valida la configuraciÃ³n y luego aplica los cambios solo si no hay errores.

```bash
make sys-apply-safe
```

**QuÃ© hace:** Ejecuta `make sys-check` y, si es exitoso, procede con `make sys-apply`.

---

### `make sys-apply-fast`
Aplica cambios omitiendo algunas verificaciones internas de NixOS para mayor velocidad.

```bash
make sys-apply-fast
```

---

### `make sys-test`
Prueba tu configuraciÃ³n compilÃ¡ndola y activÃ¡ndola temporalmente. Los cambios se perderÃ¡n en el prÃ³ximo reinicio y no se crea una generaciÃ³n de arranque.

```bash
make sys-test
```

---

### `make sys-build`
Compila la configuraciÃ³n sin aplicar cambios reales. Ãštil para verificar errores antes de un switch.

```bash
make sys-build
```

---

### `make sys-check`
Realiza validaciones profundas (sintaxis, evaluaciÃ³n y linting).

```bash
make sys-check
```

**QuÃ© hace:**
1. Verifica la sintaxis del flake con `nix flake check`
2. EvalÃºa la configuraciÃ³n del hostname actual
3. Ejecuta `statix` para detectar problemas comunes (si estÃ¡ instalado)

> [!NOTE]
> Este comando fue corregido para evitar errores de sintaxis en el shell cuando `statix` no estÃ¡ instalado.

---

### `make sys-status`
**ðŸ¥ Dashboard de Salud** - Muestra un resumen del estado del sistema, espacio en disco, servicios fallidos y estado de Git.

```bash
make sys-status
```

---

### `make sys-doctor`
DiagnÃ³stico y reparaciÃ³n automÃ¡tica de permisos en directorios de configuraciÃ³n del usuario (`~/.config` y `~/.local`).

```bash
make sys-doctor
# o usando el alias:
make fix-permissions
```

**QuÃ© hace:**
1. Verifica permisos en `~/.config`
2. Verifica permisos en `~/.local`
3. Corrige automÃ¡ticamente cualquier problema de propiedad encontrado

> [!NOTE]
> Este comando se ejecuta automÃ¡ticamente como parte de `make sys-deploy`. TambiÃ©n puedes ejecutarlo directamente si solo necesitas corregir permisos sin hacer deploy completo.

---

### `make sys-fix-git`
Corrige problemas de permisos en el repositorio Git del directorio del flake.

```bash
make sys-fix-git
```

**QuÃ© hace:**
- Verifica la propiedad de los archivos en `.git/objects`
- Corrige automÃ¡ticamente la propiedad si encuentra archivos que no pertenecen al usuario actual

> [!NOTE]
> Este comando se ejecuta automÃ¡ticamente como parte de `make sys-apply` y `make sys-deploy`.

---

### `make sys-copy-hw-config`
Copia la configuraciÃ³n de hardware desde `/etc/nixos` al directorio de Dotfiles.

```bash
make sys-copy-hw-config
```

**QuÃ© hace:**
1. Copia `hardware-configuration.nix` desde `/etc/nixos/` al directorio del flake
2. Copia `configuration.nix` desde `/etc/nixos/` al directorio del flake
3. Ajusta los permisos de los archivos copiados al usuario actual

**CuÃ¡ndo usarlo:** DespuÃ©s de ejecutar `nixos-generate-config` en un sistema nuevo o cuando necesitas actualizar la configuraciÃ³n de hardware manualmente.

---

### `make sys-hw-scan`
Genera una nueva configuraciÃ³n de hardware para el hostname actual.

```bash
make sys-hw-scan
```

**QuÃ© hace:**
- Ejecuta `nixos-generate-config --show-hardware-config`
- Guarda el resultado en `hosts/$(HOSTNAME)/hardware-configuration-new.nix`
- No sobrescribe la configuraciÃ³n existente (usa un nombre diferente para comparar)

**CuÃ¡ndo usarlo:** Cuando agregas nuevo hardware o cambias componentes del sistema.

---

## ComparaciÃ³n de Operaciones

| Comando | Compila | Activa | Persiste | GeneraciÃ³n |
|---------|---------|--------|----------|------------|
| `make sys-build` | âœ… | âŒ | N/A | âŒ |
| `make sys-test` | âœ… | âœ… | Solo sesiÃ³n | âŒ |
| `make sys-apply` | âœ… | âœ… | Permanente | âœ… |
| `make sys-boot` | âœ… | âŒ | PrÃ³ximo boot | âœ… |

> [!TIP]
> **Workflow recomendado para cambios seguros:**
> `make sys-check` â†’ `make sys-test` â†’ `make sys-apply`
