---
title: Updates
description: Gu√≠a completa para actualizar tu sistema NixOS usando los comandos del Makefile.
---

# Actualizaciones del Sistema

Esta gu√≠a explica c√≥mo mantener tu sistema NixOS actualizado usando los comandos del Makefile. Los comandos de actualizaci√≥n te permiten mantener tus paquetes y configuraciones al d√≠a de forma segura y controlada.

## Comandos de Actualizaci√≥n Disponibles

Los comandos principales para actualizar tu sistema son:

- `make upd-all` - Actualiza todos los inputs del flake (actualiza `flake.lock`)
- `make upd-nixpkgs` - Actualiza solo el repositorio nixpkgs
- `make upd-hydenix` - Actualiza solo el framework hydenix
- `make upd-input INPUT=name` - Actualiza un input espec√≠fico
- `make upd-diff` - Muestra las diferencias en `flake.lock` despu√©s de actualizar
- `make upd-upgrade` - Actualiza todos los inputs y aplica cambios de forma segura
- `make upd-show` - Muestra la estructura de outputs del flake
- `make upd-check` - Valida la consistencia y sintaxis del flake

### Nota sobre Compatibilidad

Los comandos antiguos siguen funcionando como aliases por compatibilidad:
- `make update` ‚Üí `make upd-all`
- `make update-nixpkgs` ‚Üí `make upd-nixpkgs`
- `make update-hydenix` ‚Üí `make upd-hydenix`
- `make update-input` ‚Üí `make upd-input`
- `make flake-diff` ‚Üí `make upd-diff`
- `make upgrade` ‚Üí `make upd-upgrade`
- `make show` ‚Üí `make upd-show`
- `make flake-check` ‚Üí `make upd-check`

Se recomienda usar la nueva nomenclatura con prefijos (`upd-*`) para mayor claridad y consistencia.

---

## `make upd-all`

Actualiza todas las inputs del flake y modifica el archivo `flake.lock` con las √∫ltimas versiones disponibles.

```bash
make upd-all
```

**Alias:** `make update` (compatibilidad hacia atr√°s)

### ¬øQu√© hace?

Este comando ejecuta `nix flake update` que actualiza **todos** los inputs definidos en tu `flake.nix`, incluyendo:

- `nixpkgs` - El repositorio principal de paquetes de NixOS
- `hydenix` - El framework de configuraci√≥n
- `home-manager` - Gestor de configuraci√≥n de usuario
- Cualquier otro input que tengas definido

El comando muestra una interfaz visual con colores que indica el progreso de la actualizaci√≥n.

### Cu√°ndo usarlo

- **Rutina semanal**: Para mantener tu sistema actualizado con las √∫ltimas versiones
- **Antes de instalar software nuevo**: Asegura que tienes las versiones m√°s recientes disponibles
- **Cuando buscas nuevas caracter√≠sticas**: Las actualizaciones traen nuevas opciones y mejoras

### ‚ö†Ô∏è Importante

Despu√©s de ejecutar `make upd-all`, el archivo `flake.lock` se modifica pero **los cambios no se aplican autom√°ticamente**. Debes ejecutar `make sys-apply` para aplicar las actualizaciones al sistema.

### Flujo recomendado

```bash
# 1. Actualizar los inputs
make upd-all

# 2. Ver qu√© cambiar√≠a (opcional pero recomendado)
make sys-dry-run

# 3. Ver los cambios en flake.lock
make upd-diff

# 4. Validar la configuraci√≥n
make sys-check

# 5. Probar la nueva configuraci√≥n sin aplicar
make sys-test

# 6. Si todo est√° bien, aplicar los cambios
make sys-apply

# Si algo falla, puedes revertir:
make gen-rollback
```

### Ver los cambios

Despu√©s de `make upd-all`, puedes ver exactamente qu√© cambi√≥ usando:

```bash
make upd-diff
```

Este comando muestra las diferencias en `flake.lock` usando `git diff`. Si no hay cambios sin confirmar, te indicar√° que puedes ejecutar `make upd-all` para actualizar los inputs.

---

## `make upd-nixpkgs`

Actualiza √∫nicamente el repositorio `nixpkgs`, dejando los dem√°s inputs sin cambios.

```bash
make upd-nixpkgs
```

**Alias:** `make update-nixpkgs` (compatibilidad hacia atr√°s)

### ¬øQu√© hace?

Ejecuta `nix flake lock --update-input nixpkgs`, actualizando solo el input de nixpkgs en `flake.lock`. El comando muestra una interfaz visual con informaci√≥n sobre la actualizaci√≥n.

### Cu√°ndo usarlo

- **Actualizaci√≥n selectiva**: Quieres nuevas versiones de paquetes pero prefieres mantener hydenix en su versi√≥n actual
- **Debugging**: Cuando sospechas que una actualizaci√≥n de hydenix est√° causando problemas
- **Control fino**: Necesitas actualizar solo los paquetes del sistema, no el framework

### Ejemplo de uso

```bash
# Actualizar solo nixpkgs
make upd-nixpkgs

# Ver qu√© cambi√≥
make upd-diff

# Validar configuraci√≥n
make sys-check

# Aplicar cambios
make sys-apply
```

---

## `make upd-hydenix`

Actualiza √∫nicamente el framework hydenix, dejando nixpkgs y otros inputs sin cambios.

```bash
make upd-hydenix
```

**Alias:** `make update-hydenix` (compatibilidad hacia atr√°s)

### ¬øQu√© hace?

Ejecuta `nix flake lock --update-input hydenix`, actualizando solo el input de hydenix en `flake.lock`. El comando muestra una interfaz visual con informaci√≥n sobre la actualizaci√≥n del framework.

### Cu√°ndo usarlo

- **Nueva versi√≥n disponible**: Cuando hay una nueva versi√≥n de hydenix con mejoras o correcciones
- **Nuevas caracter√≠sticas**: Quieres probar nuevas funcionalidades del framework
- **Correcciones de bugs**: Hydenix ha publicado fixes que necesitas

### Ejemplo de uso

```bash
# Actualizar solo hydenix
make upd-hydenix

# Ver los cambios
make upd-diff

# Validar configuraci√≥n
make sys-check

# Probar antes de aplicar
make sys-test

# Aplicar si todo est√° bien
make sys-apply
```

---

## `make upd-input INPUT=name`

Actualiza un input espec√≠fico del flake. √ötil cuando necesitas control granular sobre qu√© actualizar.

```bash
make upd-input INPUT=hydenix
make upd-input INPUT=nixpkgs
```

**Alias:** `make update-input` (compatibilidad hacia atr√°s)

### ¬øQu√© hace?

Ejecuta `nix flake lock --update-input <nombre>`, actualizando solo el input especificado. El comando muestra una interfaz visual con informaci√≥n sobre qu√© input se est√° actualizando y te recuerda usar `make upd-diff` para ver los cambios y `make sys-apply` para aplicarlos.

### Inputs disponibles

Los inputs comunes que puedes actualizar incluyen:

- `nixpkgs` - Repositorio principal de paquetes
- `hydenix` - Framework de configuraci√≥n
- `nixos-hardware` - Configuraciones espec√≠ficas de hardware
- `mynixpkgs` - Fork personalizado de nixpkgs (si lo tienes)
- `opencode` - Input personalizado (si lo tienes)
- `zen-browser-flake` - Flake del navegador Zen (si lo tienes)

### Cu√°ndo usarlo

- **Actualizaci√≥n espec√≠fica**: Necesitas actualizar solo un componente espec√≠fico
- **Debugging**: Aislar problemas actualizando inputs uno por uno
- **Control preciso**: Quieres mantener algunos inputs fijos mientras actualizas otros

### Ejemplos

```bash
# Actualizar solo hydenix
make upd-input INPUT=hydenix

# Actualizar solo nixpkgs
make upd-input INPUT=nixpkgs

# Actualizar otro input personalizado
make upd-input INPUT=zen-browser-flake

# Ver los cambios despu√©s
make upd-diff

# Validar configuraci√≥n
make sys-check

# Aplicar cambios
make sys-apply
```

### Manejo de errores

Si olvidas especificar el par√°metro `INPUT`, el comando te mostrar√° un mensaje de error con la lista de inputs disponibles:

```bash
make upd-input
# Error: Variable INPUT requerida
# Uso: make upd-input INPUT=<nombre>
# Inputs conocidos: nixpkgs, hydenix, nixos-hardware, zen-browser-flake
```

---

## `make upd-diff`

Muestra las diferencias en `flake.lock` despu√©s de actualizar inputs. Este comando es inteligente y detecta si hay cambios sin confirmar.

```bash
make upd-diff
```

**Alias:** `make flake-diff` (compatibilidad hacia atr√°s)

### ¬øQu√© hace?

Este comando analiza el estado de `flake.lock` y muestra:

- Si hay cambios sin confirmar en `flake.lock`, los muestra usando `git diff`
- Si no hay cambios, te indica que puedes ejecutar `make upd-all` para actualizar
- Muestra mensajes informativos sobre qu√© hacer despu√©s de ver los cambios

### Cu√°ndo usarlo

- **Despu√©s de actualizar**: Para ver exactamente qu√© inputs cambiaron y sus versiones
- **Antes de aplicar**: Para revisar los cambios antes de ejecutar `make sys-apply`
- **Verificaci√≥n**: Para confirmar que una actualizaci√≥n funcion√≥ correctamente

### Ejemplo de salida

Si hay cambios:
```
üîí Changes in flake.lock (updated inputs):
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
[git diff output mostrando los cambios]
```

Si no hay cambios:
```
‚úì No uncommitted changes in flake.lock
Tip: Run 'make upd-all' to update flake inputs
```

---

## `make upd-upgrade`

Comando todo-en-uno que actualiza los inputs y aplica los cambios de forma segura. **Equivalente a `make upd-all` seguido de `make sys-apply-safe`**.

```bash
make upd-upgrade
```

**Alias:** `make upgrade` (compatibilidad hacia atr√°s)

### ¬øQu√© hace?

Este comando ejecuta autom√°ticamente un flujo seguro de actualizaci√≥n:

1. `make upd-all` - Actualiza todos los inputs del flake
2. `make sys-apply-safe` - Valida la configuraci√≥n y luego aplica los cambios

El comando `sys-apply-safe` incluye validaci√≥n autom√°tica antes de aplicar, lo que lo hace m√°s seguro que aplicar directamente.

### ‚ö†Ô∏è Advertencia

Aunque este comando incluye validaci√≥n, **aplica cambios inmediatamente** despu√©s de actualizar. √ösalo con precauci√≥n.

### Cu√°ndo usarlo

- **Actualizaciones de rutina**: Cuando conf√≠as en que las actualizaciones ser√°n seguras
- **Sistemas de desarrollo**: En entornos donde puedes permitirte rollback f√°cil
- **Actualizaciones menores**: Para cambios peque√±os que no requieren revisi√≥n exhaustiva

### Cu√°ndo NO usarlo

- **Cambios importantes**: Cuando hay actualizaciones mayores que podr√≠an romper cosas
- **Sistemas de producci√≥n**: En sistemas cr√≠ticos donde la estabilidad es prioritaria
- **Primera vez**: Cuando no est√°s seguro de qu√© cambios traer√°n las actualizaciones

### Flujo m√°s seguro (recomendado)

En lugar de `make upd-upgrade`, usa este flujo para mayor control:

```bash
# 1. Actualizar
make upd-all

# 2. Ver cambios
make upd-diff

# 3. Ver qu√© cambiar√≠a
make sys-dry-run

# 4. Validar configuraci√≥n
make sys-check

# 5. Probar sin aplicar
make sys-test

# 6. Si todo est√° bien, aplicar
make sys-apply

# Si algo falla, revertir
make gen-rollback
```

---

## `make upd-show`

Muestra la estructura de outputs y metadatos del flake.

```bash
make upd-show
```

**Alias:** `make show` (compatibilidad hacia atr√°s)

### ¬øQu√© hace?

Ejecuta `nix flake show` para mostrar todos los outputs disponibles del flake, incluyendo:

- Configuraciones del sistema (`nixosConfigurations`)
- Paquetes disponibles (`packages`)
- M√≥dulos de desarrollo (`devShells`)
- Cualquier otro output definido en tu `flake.nix`

### Cu√°ndo usarlo

- **Explorar el flake**: Para ver qu√© configuraciones y paquetes est√°n disponibles
- **Verificar estructura**: Para confirmar que el flake est√° correctamente configurado
- **Documentaci√≥n**: Para entender qu√© outputs expone tu flake

---

## `make upd-check`

Valida la sintaxis y consistencia del flake sin construir nada.

```bash
make upd-check
```

**Alias:** `make flake-check` (compatibilidad hacia atr√°s)

### ¬øQu√© hace?

Ejecuta `nix flake check` para validar:

- Sintaxis del flake
- Estructura de inputs y outputs
- Referencias a inputs existentes
- Consistencia general del flake

### Cu√°ndo usarlo

- **Antes de aplicar cambios**: Para asegurar que el flake es v√°lido
- **Despu√©s de editar flake.nix**: Para verificar que no introdujiste errores
- **Debugging**: Cuando hay problemas con el flake

### Nota

Este comando es parte del flujo de `make sys-check`, que tambi√©n valida la evaluaci√≥n de la configuraci√≥n del sistema.

---

## Comparaci√≥n de Comandos

| Comando | Actualiza | Aplica cambios | Validaci√≥n | Uso recomendado |
|---------|-----------|----------------|------------|------------------|
| `make upd-all` | Todos los inputs | ‚ùå No | ‚ùå No | Rutina semanal |
| `make upd-nixpkgs` | Solo nixpkgs | ‚ùå No | ‚ùå No | Actualizaci√≥n selectiva de paquetes |
| `make upd-hydenix` | Solo hydenix | ‚ùå No | ‚ùå No | Actualizaci√≥n del framework |
| `make upd-input INPUT=name` | Input espec√≠fico | ‚ùå No | ‚ùå No | Control granular |
| `make upd-diff` | ‚ùå No | ‚ùå No | ‚ùå No | Ver cambios despu√©s de actualizar |
| `make upd-show` | ‚ùå No | ‚ùå No | ‚ùå No | Explorar estructura del flake |
| `make upd-check` | ‚ùå No | ‚ùå No | ‚úÖ S√≠ | Validar sintaxis del flake |
| `make upd-upgrade` | Todos los inputs | ‚úÖ S√≠ | ‚úÖ S√≠ | Actualizaciones r√°pidas con validaci√≥n |

---

## Flujos de Trabajo Recomendados

### Flujo Seguro (Recomendado para producci√≥n)

```bash
# 1. Actualizar inputs
make upd-all

# 2. Ver cambios en flake.lock
make upd-diff

# 3. Validar sintaxis del flake
make upd-check

# 4. Ver qu√© se construir√≠a/descargar√≠a
make sys-dry-run

# 5. Validar configuraci√≥n completa
make sys-check

# 6. Probar sin aplicar
make sys-test

# 7. Si todo est√° bien, aplicar
make sys-apply

# Si algo falla:
make gen-rollback
```

### Flujo R√°pido (Para desarrollo)

```bash
# Actualizaci√≥n r√°pida cuando conf√≠as en los cambios
make upd-upgrade

# Si algo falla:
make gen-rollback
```

### Flujo Selectivo (Actualizar solo un componente)

```bash
# Actualizar solo hydenix
make upd-input INPUT=hydenix
make upd-diff              # Ver cambios
make upd-check             # Validar flake
make sys-check             # Validar configuraci√≥n
make sys-test              # Probar
make sys-apply             # Aplicar
```

### Flujo Semanal de Mantenimiento

```bash
# Lunes por la ma√±ana
make upd-all               # Actualizar inputs
make upd-diff              # Ver cambios
make upd-check             # Validar flake
make sys-dry-run           # Ver qu√© cambiar√≠a
make sys-check             # Validar configuraci√≥n
make sys-test              # Probar
make sys-apply             # Aplicar si todo bien
make sys-gc                # Limpiar espacio (garbage collection)
```

---

## Ver Cambios Despu√©s de Actualizar

Despu√©s de ejecutar cualquier comando de actualizaci√≥n, puedes ver qu√© cambi√≥:

```bash
# Ver diferencias en flake.lock (comando inteligente)
make upd-diff

# Ver estructura completa del flake
make upd-show

# Validar que el flake sigue siendo v√°lido
make upd-check

# Ver estado de git (incluye cambios en flake.lock)
make git-status
```

### Detalles sobre `make upd-diff`

El comando `upd-diff` es inteligente y:
- Detecta autom√°ticamente si hay cambios sin confirmar en `flake.lock`
- Muestra las diferencias usando `git diff` si hay cambios
- Te sugiere ejecutar `make upd-all` si no hay cambios
- Te recuerda usar `make sys-apply` para aplicar los cambios despu√©s de revisarlos

---

## Resoluci√≥n de Problemas

### Si una actualizaci√≥n rompe algo

```bash
# Revertir inmediatamente a la generaci√≥n anterior
make gen-rollback

# Ver qu√© generaciones tienes disponibles
make gen-list

# Comparar generaciones espec√≠ficas
make gen-diff GEN1=30 GEN2=32

# Comparar generaci√≥n actual con la anterior
make gen-diff-current
```

### Si quieres ver qu√© inputs est√°n desactualizados

```bash
# Ver estructura y outputs del flake
make upd-show

# Validar sintaxis y consistencia del flake
make upd-check

# Ver informaci√≥n detallada de inputs
nix flake metadata
```

### Si necesitas volver a una versi√≥n espec√≠fica

```bash
# Ver todas las generaciones con detalles
make gen-list

# Ver tama√±os de las generaciones
make gen-sizes

# Ver informaci√≥n de la generaci√≥n actual
make gen-current

# Revertir a una generaci√≥n espec√≠fica (comando directo de nixos-rebuild)
sudo nixos-rebuild switch --rollback-to-generation <n√∫mero>
```

### Si el flake tiene errores de sintaxis

```bash
# Validar el flake
make upd-check

# Si hay errores, ver detalles con trace
nix flake check --show-trace
```

---

## Mejores Pr√°cticas

1. **Actualiza regularmente**: Ejecuta `make upd-all` al menos una vez por semana
2. **Revisa los cambios**: Usa `make upd-diff` antes de aplicar para ver qu√© cambi√≥
3. **Valida el flake**: Usa `make upd-check` para asegurar que el flake sigue siendo v√°lido
4. **Valida la configuraci√≥n**: Usa `make sys-check` para validar antes de aplicar
5. **Prueba primero**: Usa `make sys-test` antes de `make sys-apply`
6. **Mant√©n backups**: Usa Git para versionar tus cambios y commits regulares
7. **Documenta problemas**: Si encuentras incompatibilidades, documenta qu√© input las caus√≥
8. **Usa rollback sin miedo**: Si algo falla, `make gen-rollback` es tu amigo
9. **Usa dry-run**: Ejecuta `make sys-dry-run` para ver qu√© se construir√≠a sin aplicar
10. **Actualizaciones selectivas**: Usa `make upd-input` para actualizar inputs espec√≠ficos cuando sea necesario

---

## Resumen R√°pido

### Comandos de Actualizaci√≥n

```bash
# Actualizar todo
make upd-all

# Actualizar solo nixpkgs
make upd-nixpkgs

# Actualizar solo hydenix
make upd-hydenix

# Actualizar input espec√≠fico
make upd-input INPUT=nombre

# Ver cambios despu√©s de actualizar
make upd-diff

# Ver estructura del flake
make upd-show

# Validar flake
make upd-check

# Actualizar y aplicar (todo-en-uno con validaci√≥n)
make upd-upgrade
```

### Comandos de Aplicaci√≥n

```bash
# Validar configuraci√≥n
make sys-check

# Ver qu√© se construir√≠a (dry-run)
make sys-dry-run

# Probar sin aplicar
make sys-test

# Aplicar cambios
make sys-apply

# Aplicar con validaci√≥n previa (recomendado)
make sys-apply-safe

# Aplicar r√°pido (omite verificaciones)
make sys-apply-fast
```

### Comandos de Rollback

```bash
# Revertir a generaci√≥n anterior (r√°pido)
make gen-rollback

# Revertir a commit espec√≠fico (completo)
make gen-rollback-commit COMMIT=9220122

# Ver todas las generaciones
make gen-list

# Comparar generaciones
make gen-diff GEN1=n GEN2=m

# Comparar actual con anterior
make gen-diff-current
```

### Nota sobre Aliases

Todos los comandos antiguos siguen funcionando por compatibilidad:
- `make update` ‚Üí `make upd-all`
- `make switch` ‚Üí `make sys-apply`
- `make test` ‚Üí `make sys-test`
- `make rollback` ‚Üí `make gen-rollback`
- Y muchos m√°s...

Consulta `make help-aliases` para ver la lista completa de aliases disponibles.

---

Para m√°s informaci√≥n sobre otros comandos del Makefile, consulta la [documentaci√≥n completa del Makefile](/docs/makefile).
